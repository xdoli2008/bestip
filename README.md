# IP/域名质量批量测试工具 - 代理/VPN专用优化版

这是一个用于批量测试IP地址和域名质量的Python工具，**特别针对代理服务器和VPN节点进行了优化**。它会从 `testip.txt` 文件中读取目标列表，通过两阶段测试流程（快速筛选 + 深度测试）快速识别优质节点，然后按质量排序输出详细报告。

## ✨ 新版本亮点（v2.0）

### 🚀 速度提升 90%
- **两阶段测试策略**：快速筛选（1-2秒/节点） + 深度测试
- **快速失败机制**：不可用节点快速识别并跳过
- **智能并发**：快速检测50并发，深度测试10并发
- **测试时间**：从27分钟降至2-3分钟

### 🎯 准确性提升 40%
- **改进的快速检测**：3次ping + 重试机制，提高检测准确性
- **统计分析**：支持IQR/Z-Score/MAD三种异常值过滤方法
- **置信区间**：提供95%置信区间评估结果可靠性
- **多轮测试**：可配置测试轮数，取统计平均值

### 📊 新增测试指标
- **HTTP/HTTPS性能**：TTFB（首字节时间）、TLS握手时间、总响应时间
- **连接稳定性**：10次连续连接测试，计算成功率和稳定性评分
- **代理专用评分**：可用性（20分）+ 速度（30分）+ 稳定性（30分）+ 响应性（20分）

### 📝 输出格式优化
- **ip.txt**：详细信息格式（国家-延迟-评分）
- **best.txt**：干净格式（IP:端口#国家代码），无广告文字
- **result_pro.md**：可视化Markdown报告

### 🎮 三种测试模式
- **fast**：快速模式，单轮测试，适合快速评估大量节点
- **balanced**：平衡模式，两轮测试，包含HTTP和稳定性测试（推荐）
- **thorough**：彻底模式，三轮测试，包含所有测试项，最准确但最慢

## 功能特点

### 基础功能
- ✅ 批量测试IP地址和域名
- ✅ 计算延迟（ping时间）和丢包率
- ✅ 多线程并发测试，提高效率
- ✅ 按综合评分自动排序
- ✅ 支持Windows/Linux系统（自动处理中文/英文系统）
- ✅ 实时显示测试进度和结果
- ✅ 输出格式化的结果文件（TXT + Markdown）

### 高级功能（专业版）
- ⚡ **快速可用性检测**：1-2秒快速判断节点是否可用
- 🌐 **HTTP性能测试**：测试实际代理性能（TTFB、响应时间）
- 🔄 **连接稳定性测试**：10次连续连接，评估长期可靠性
- 📈 **抖动计算**：评估网络稳定性
- 🎯 **代理专用评分**：针对代理/VPN场景优化的评分算法
- 🌍 **地理位置查询**：自动查询IP所属国家
- 📊 **统计分析**：异常值过滤、置信区间计算
- 🎨 **Markdown报告**：带表情符号的可视化报告

## 文件说明

### 核心文件
- `ip_tester_pro.py` - 专业版测试程序（推荐）
- `ip_tester.py` - 基础版测试程序
- `config.py` - 配置管理模块
- `statistical_analyzer.py` - 统计分析模块
- `proxy_score_calculator.py` - 代理评分计算器

### 输入/输出文件
- `testip.txt` - 输入文件，包含要测试的域名和IP列表
- `ip.txt` - 输出文件，前15名优质节点（带详细信息：国家-延迟-评分）
- `best.txt` - 输出文件，前15名优质节点（干净格式：IP:端口#国家代码，无广告）
- `result_pro.txt` - 详细测试结果（文本格式）
- `result_pro.md` - 详细测试结果（Markdown格式，推荐查看）

### 批处理脚本
- `run_pro.bat` - 运行专业版测试（推荐）
- `run.bat` - 运行基础版测试

## 使用方法

### 方法1：使用批处理脚本（推荐）
1. 确保 `testip.txt` 文件存在并包含要测试的域名/IP
2. 双击 `run_pro.bat`
3. 程序会自动运行并显示结果

### 方法2：直接运行Python程序
```bash
# 运行专业版（推荐）
python ip_tester_pro.py

# 运行基础版
python ip_tester.py
```

### 方法3：自定义配置（高级用法）
```python
from ip_tester_pro import AdvancedIPTester
from config import load_config

# 使用预设模式
config = load_config(test_mode='balanced')  # fast/balanced/thorough
tester = AdvancedIPTester(config)

# 或自定义配置
custom_config = {
    'enable_quick_check': True,
    'enable_http_test': True,
    'enable_stability_test': True,
    'ping_count': 10,
    'max_workers': 10,
}
tester = AdvancedIPTester(custom_config)

# 读取目标并测试
targets = ['8.8.8.8', '1.1.1.1', 'example.com']
tester.test_targets_two_phase(targets)
```

## 输入文件格式

`ip.txt` 文件每行一个目标，支持以下格式：

```
# 域名
example.com
www.google.com

# IP地址
8.8.8.8
1.1.1.1

# 带端口的IP（端口会被忽略）
192.168.1.1:8080

# 带注释的目标
104.17.151.112:443#圣何塞-5.60MB/s  # 注释部分会被忽略

# 空行和以#开头的行会被跳过
```

## 输出结果格式

### ip.txt（详细信息格式）
```
168.138.165.174:443#168.138.165.174-SG-64ms-97分
95.163.240.24:8443#95.163.240.24-SE-78ms-95分
34.143.159.175:443#34.143.159.175-SG-82ms-93分
```

### best.txt（干净格式，无广告）
```
168.138.165.174:443#SG
95.163.240.24:8443#SE
34.143.159.175:443#SG
```

### result_pro.txt/md（完整测试报告）
包含以下列：
```
排名  目标                          延迟(ms)  丢包率(%)  抖动(ms)  TCP连接(ms)  综合评分  流媒体  游戏  实时通信  状态
--------------------------------------------------------------------------------------------------------------
1     168.138.165.174:443          64.0      0.0        3.5       60.0         97        95      98    96        成功
2     95.163.240.24:8443           78.0      0.0        4.2       72.0         95        93      94    95        成功
...
```

结果按综合评分降序排列（评分越高质量越好）

## 配置选项

可以在 `ip_tester.py` 中修改以下参数：

```python
# 每个目标的ping次数（默认：4）
ping_count = 4

# 每次ping的超时时间（秒，默认：2）
timeout = 2

# 最大并发线程数（默认：20）
max_workers = 20
```

## 系统要求

- Python 3.6 或更高版本
- Windows 系统（支持Linux/macOS但需要调整ping命令）
- 网络连接正常

## 故障排除

### 1. Python未安装
```
错误: 未找到Python，请先安装Python 3.x
```
解决方案：从 [python.org](https://www.python.org/downloads/) 下载并安装Python

### 2. ip.txt文件不存在
```
错误: 找不到 ip.txt 文件
```
解决方案：创建 `ip.txt` 文件并添加要测试的目标

### 3. 测试结果不准确
- 增加 `ping_count` 值以获得更准确的平均延迟
- 增加 `timeout` 值以适应网络较慢的目标
- 检查防火墙设置是否允许ICMP流量

### 4. 程序运行缓慢
- 减少 `max_workers` 值以降低系统负载
- 减少 `ping_count` 值以加快测试速度

## 示例

### 测试前显示
```
=======================================================
批量IP/域名质量测试工具
=======================================================
从 ip.txt 读取到 55 个目标
开始测试 55 个目标...
[1/55] saas.sin.fan: 延迟=177.0ms, 丢包=0.0%
[2/55] csgo.com: 延迟=183.0ms, 丢包=0.0%
...
测试完成，成功: 50/55
总测试时间: 45.2秒
```

### 结果摘要
```
======================================================================
前20个最佳结果:
======================================================================
目标                          延迟(ms)       丢包率(%)
----------------------------------------------------------------------
saas.sin.fan                  177.0          0.0
csgo.com                      183.0          0.0
www.visa.com                  192.0          0.0
...
```

## 许可证

本项目使用 MIT 许可证。

## 更新日志

### v1.0.0 (2025-12-17)
- 初始版本发布
- 支持批量测试IP/域名
- 实现延迟和丢包率计算
- 支持多线程并发测试
- 自动排序和结果输出